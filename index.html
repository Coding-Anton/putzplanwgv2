<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Cleaning Rota</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Harmonious Home -->
    <!-- Application Structure Plan: Die Anwendung ist als interaktives Dashboard konzipiert, um die Nachteile eines statischen Plans zu überwinden. Der Fokus liegt auf der sofortigen Erkennbarkeit, wer aktuell für den Putzdienst verantwortlich ist. Eine prominente Anzeige des Namens und ein visuelles Hervorheben in der Rotationsliste stellen dies sicher. Die Aufgaben sind in thematische, umschaltbare Reiter (Wöchentlich, Täglich, Grundreinigung) gegliedert, was die Informationsarchitektur klar und nutzerfreundlich macht. Interaktive Checklisten für die wöchentlichen Aufgaben, gekoppelt mit einer Fortschrittsanzeige (Donut-Chart), gamifizieren den Prozess und geben direktes visuelles Feedback. Die neue Verlaufsfunktion wird über ein Modal integriert, um die Hauptansicht sauber zu halten, und nutzt localStorage zur Datenpersistenz. Die Exportfunktion macht die Daten extern nutzbar. Diese task-orientierte Struktur ist für die WG-Mitglieder intuitiver und motivierender als das blosse Ablesen eines Textdokuments. -->
    <!-- Visualization & Content Choices: 
        - Rotationsliste -> Geordnete Liste mit visueller Hervorhebung -> Interaktion über "Nächste Person"-Button -> Ziel: Klarheit über aktuellen & nächsten Dienst; Methode: HTML/CSS/JS.
        - Wöchentliche Aufgaben -> Interaktive Checklisten pro Raum -> Interaktion durch Klick (abhaken) -> Ziel: Einfache Nachverfolgung des Fortschritts; Methode: HTML Forms/JS mit localStorage-Anbindung.
        - Aufgabenfortschritt (Wöchentlich) -> Donut-Chart -> Interaktion: Dynamische Aktualisierung bei Klick auf Checkbox -> Ziel: Visuelle Motivation & schneller Überblick; Methode: Chart.js (Canvas).
        - Aufgabenkategorien (Wöchentlich/Täglich/Grundreinigung) -> Reiter-Navigation -> Interaktion durch Klick auf Reiter -> Ziel: Strukturierte Darstellung; Methode: HTML/JS.
        - Verlauf -> Modalfenster mit dynamischer Liste -> Interaktion: Öffnen/Schließen des Modals -> Ziel: Nachvollziehbarkeit vergangener Putzdienste; Methode: HTML/JS aus localStorage.
        - Export -> Button im Modal -> Interaktion: Klick löst Download aus -> Ziel: Datenportabilität; Methode: JS Blob/File-Download.
        - Alle Entscheidungen unterstützen die Dashboard-Struktur und vermeiden die Nachteile eines statischen Plans. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF8;
            color: #4A4A4A;
        }
        .tab-active {
            background-color: #00796B;
            color: #FFFFFF;
            font-weight: 500;
        }
        .tab-inactive {
            background-color: #E0E0E0;
            color: #4A4A4A;
        }
        .task-list-item input:checked + label {
            text-decoration: line-through;
            color: #9E9E9E;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 300px;
        }
        .modal-backdrop {
            background-color: rgba(0,0,0,0.5);
        }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">

        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-teal-800">Shared Living Cleaning Rota</h1>
            <p class="text-lg mt-2 text-gray-600">Your interactive plan for a tidy home!</p>
        </header>

        <main>
            <section id="rotation-section" class="bg-white p-6 rounded-2xl shadow-lg mb-8">
                <h2 class="text-2xl font-bold text-center mb-4 text-teal-700">Whose turn is it this week?</h2>
                <div class="text-center p-4 bg-amber-100 border-l-4 border-amber-400 rounded-lg">
                    <p class="text-lg text-gray-700">Week from <span id="current-week-start"></span> to <span id="current-week-end"></span>:</p>
                    <p id="current-person" class="text-3xl font-bold text-amber-800 my-2">-</p>
                </div>
                
                <div class="mt-6">
                    <h3 class="text-lg font-semibold mb-3 text-center">Rotation:</h3>
                    <p class="text-center text-xs text-gray-500 mb-2">(Click a name to swap the current turn)</p>
                    <ol id="rotation-list" class="flex flex-wrap justify-center gap-2"></ol>
                </div>

                <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mt-6">
                    <button id="next-person-btn" class="w-full sm:w-auto bg-teal-600 text-white font-bold py-2 px-6 rounded-full hover:bg-teal-700 transition-colors duration-300 shadow-md">
                        Next Person & Start Week →
                    </button>
                     <button id="show-history-btn" class="w-full sm:w-auto bg-gray-200 text-gray-700 font-bold py-2 px-6 rounded-full hover:bg-gray-300 transition-colors duration-300">
                        Show History
                    </button>
                </div>
            </section>

            <section id="tasks-section" class="bg-white p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-bold text-center mb-6 text-teal-700">Current Tasks</h2>
                
                <div id="tabs" class="flex justify-center mb-6 rounded-full p-1 bg-gray-200 w-full max-w-md mx-auto">
                    <button data-tab="weekly" class="tab-button w-1/3 py-2 px-4 rounded-full text-sm sm:text-base transition-colors duration-300">Weekly</button>
                    <button data-tab="daily" class="tab-button w-1/3 py-2 px-4 rounded-full text-sm sm:text-base transition-colors duration-300">Daily (Everyone)</button>
                    <button data-tab="monthly" class="tab-button w-1/3 py-2 px-4 rounded-full text-sm sm:text-base transition-colors duration-300">Deep Clean</button>
                </div>

                <div id="tab-content">
                    <div id="weekly-tasks" class="tab-pane">
                        <p class="text-center mb-6 text-gray-600">These tasks are for <span class="font-bold" id="current-person-tasks">-</span> to complete.</p>
                        <div class="grid md:grid-cols-2 gap-8">
                            <div id="task-lists-container" class="space-y-6"></div>
                            <div class="flex flex-col items-center justify-center">
                                <h3 class="text-lg font-semibold mb-4 text-center">Progress</h3>
                                <div class="chart-container">
                                    <canvas id="progressChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="daily-tasks" class="tab-pane hidden">
                        <div class="max-w-2xl mx-auto bg-gray-50 p-6 rounded-lg">
                           <h3 class="text-xl font-bold text-teal-700 mb-4">Daily Tasks for EVERYONE!</h3>
                           <p class="mb-4 text-gray-600">These small things are only fair and ensure a baseline of cleanliness is maintained.</p>
                           <ul class="list-disc list-inside space-y-2 text-gray-700">
                                <li>Wash your own dishes, pots, and cutlery <strong>immediately</strong> or put them in the dishwasher.</li>
                                <li>Briefly wipe down your work surface and the stove after cooking.</li>
                                <li>Put away your own shoes and jackets properly.</li>
                                <li>In the bathroom, briefly rinse the sink after use and remove your own hair from the drain.</li>
                           </ul>
                        </div>
                    </div>
                    <div id="monthly-tasks" class="tab-pane hidden">
                        <div class="max-w-2xl mx-auto bg-gray-50 p-6 rounded-lg">
                           <h3 class="text-xl font-bold text-teal-700 mb-4">Joint Deep Clean (every 2-3 months)</h3>
                           <p class="mb-4 text-gray-600">It's best if we do these tasks all together on a weekend.</p>
                           <ul class="list-disc list-inside space-y-2 text-gray-700">
                                <li>Clean the inside of the refrigerator.</li>
                                <li>Take the glass bottles to the glass recycling container.</li>
                                <li>Clean the oven.</li>
                                <li>Clean the windows in the common areas.</li>
                                <li>Wipe down doors and door frames.</li>
                           </ul>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div id="history-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div class="fixed inset-0 modal-backdrop"></div>
        <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-2xl z-10 transform transition-all max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4 pb-4 border-b">
                <h2 class="text-2xl font-bold text-teal-700">Cleaning History</h2>
                <button id="close-history-btn" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
            </div>
            <div id="history-content" class="overflow-y-auto flex-grow pr-2">
            </div>
            <div class="mt-6 pt-4 border-t flex justify-end">
                <button id="export-history-btn" class="bg-teal-600 text-white font-bold py-2 px-6 rounded-full hover:bg-teal-700 transition-colors duration-300 shadow-md">
                    Export History
                </button>
            </div>
        </div>
    </div>

    <div id="confirm-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div class="fixed inset-0 modal-backdrop"></div>
        <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-md z-10 transform transition-all">
            <h2 id="confirm-modal-title" class="text-xl font-bold text-gray-800 mb-4">Confirmation</h2>
            <p id="confirm-modal-text" class="text-gray-600 mb-6 leading-relaxed">Are you sure?</p>
            <div class="flex justify-end gap-4">
                <button id="confirm-modal-no" class="bg-gray-200 text-gray-700 font-bold py-2 px-6 rounded-full hover:bg-gray-300 transition-colors duration-300">Cancel</button>
                <button id="confirm-modal-yes" class="bg-amber-500 text-white font-bold py-2 px-6 rounded-full hover:bg-amber-600 transition-colors duration-300 shadow-md">Yes, Confirm</button>
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const APP_STORAGE_KEY = 'wgPutzplanData';

    const names = ['Jakob', 'Annamaria', 'Fabiana', 'Anton', 'Kshitija'];
    const weeklyTasks = {
        'Kitchen': ['Thoroughly clean countertops & sink', 'Clean stove / hob', 'Wipe down kitchen fronts & appliance exteriors (remove fingerprints)', 'Empty all bins (general, paper) & wipe if necessary', 'Sweep & then mop the floor'],
        'Bathroom': ['Clean the two sinks and the large mirror', 'Clean shower / bathtub and fittings', 'Dust and wipe down the shelf', 'Sweep & mop the floor'],
        'Separate WC': ['Thoroughly clean toilet inside and out', 'Clean the sink', 'Sweep & mop the floor', 'Refill toilet paper and soap if needed'],
        'Living Area / Hallway': ['Dust shelves, TV, and other surfaces', 'Tidy up common area (fold blankets, put away magazines, fluff cushions)', 'Thoroughly sweep/vacuum the entire floor and mop if necessary']
    };
    
    let totalWeeklyTasks = Object.values(weeklyTasks).flat().length;
    let appState = {};
    let progressChart;
    let confirmAction = null;
    
    const currentPersonEl = document.getElementById('current-person');
    const rotationListEl = document.getElementById('rotation-list');
    const nextPersonBtn = document.getElementById('next-person-btn');
    const taskListsContainer = document.getElementById('task-lists-container');
    const currentPersonTasksEls = document.querySelectorAll('#current-person-tasks');
    const tabs = document.querySelectorAll('.tab-button');
    const tabPanes = document.querySelectorAll('.tab-pane');
    const weekStartEl = document.getElementById('current-week-start');
    const weekEndEl = document.getElementById('current-week-end');

    const historyModal = document.getElementById('history-modal');
    const showHistoryBtn = document.getElementById('show-history-btn');
    const closeHistoryBtn = document.getElementById('close-history-btn');
    const exportHistoryBtn = document.getElementById('export-history-btn');
    const historyContent = document.getElementById('history-content');

    const confirmModal = document.getElementById('confirm-modal');
    const confirmModalTitle = document.getElementById('confirm-modal-title');
    const confirmModalText = document.getElementById('confirm-modal-text');
    const confirmModalYesBtn = document.getElementById('confirm-modal-yes');
    const confirmModalNoBtn = document.getElementById('confirm-modal-no');

    function getWeekId(date) {
        const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
        const dayNum = d.getUTCDay() || 7;
        d.setUTCDate(d.getUTCDate() + 4 - dayNum);
        const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
        const weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        return `${d.getUTCFullYear()}-W${String(weekNo).padStart(2, '0')}`;
    }

    function getWeekDateRange(date) {
        const start = new Date(date);
        start.setDate(start.getDate() - start.getDay() + (start.getDay() === 0 ? -6 : 1));
        const end = new Date(start);
        end.setDate(start.getDate() + 6);
        const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
        return {
            start: start.toLocaleDateString('en-GB', options),
            end: end.toLocaleDateString('en-GB', options)
        };
    }

    function saveState() {
        localStorage.setItem(APP_STORAGE_KEY, JSON.stringify(appState));
    }

    function loadState() {
        const storedState = localStorage.getItem(APP_STORAGE_KEY);
        if (storedState) {
            appState = JSON.parse(storedState);
        } else {
            appState = {
                currentIndex: 0,
                history: [],
                currentWeekStartDate: new Date().toISOString().split('T')[0]
            };
            saveState();
        }
        
        const today = new Date();
        const currentWeekId = getWeekId(today);
        const lastSavedWeekId = getWeekId(new Date(appState.currentWeekStartDate));
        
        if(currentWeekId !== lastSavedWeekId && appState.currentWeekTasks) {
            nextPerson(true);
        }
    }

    function createCheckboxes() {
        taskListsContainer.innerHTML = '';
        if (!appState.currentWeekTasks) appState.currentWeekTasks = {};

        for (const area in weeklyTasks) {
            const areaContainer = document.createElement('div');
            areaContainer.className = 'bg-gray-50 p-4 rounded-lg';
            const title = document.createElement('h4');
            title.className = 'text-lg font-semibold mb-3 text-teal-800 border-b pb-2';
            title.textContent = area;
            areaContainer.appendChild(title);

            const list = document.createElement('ul');
            list.className = 'space-y-2';
            weeklyTasks[area].forEach((task, index) => {
                const li = document.createElement('li');
                li.className = 'task-list-item flex items-center';
                const checkboxId = `${area.replace(/\s+/g, '-')}-${index}`;
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = checkboxId;
                checkbox.checked = appState.currentWeekTasks[checkboxId] || false;
                checkbox.className = 'h-4 w-4 rounded border-gray-300 text-teal-600 focus:ring-teal-500';
                checkbox.addEventListener('change', (e) => {
                    appState.currentWeekTasks[checkboxId] = e.target.checked;
                    saveState();
                    updateChart();
                });
                
                const label = document.createElement('label');
                label.htmlFor = checkboxId;
                label.textContent = task;
                label.className = 'ml-3 block text-sm text-gray-700';

                li.appendChild(checkbox);
                li.appendChild(label);
                list.appendChild(li);
            });
            areaContainer.appendChild(list);
            taskListsContainer.appendChild(areaContainer);
        }
    }

    function updateDisplay() {
        const currentName = names[appState.currentIndex];
        currentPersonEl.textContent = currentName;
        currentPersonTasksEls.forEach(el => el.textContent = currentName);

        const range = getWeekDateRange(new Date(appState.currentWeekStartDate));
        weekStartEl.textContent = range.start;
        weekEndEl.textContent = range.end;

        rotationListEl.innerHTML = '';
        names.forEach((name, index) => {
            const li = document.createElement('li');
            li.textContent = name;
            
            const isActive = index === appState.currentIndex;
            li.className = `py-1 px-3 rounded-full text-sm font-medium transition-all duration-300 ${isActive ? 'bg-amber-400 text-amber-900 shadow' : 'bg-gray-200 text-gray-600 cursor-pointer hover:bg-amber-200'}`;
            
            if (!isActive) {
                li.addEventListener('click', () => {
                    showConfirmModal(
                        'Swap Duty?',
                        `Do you want to switch to <strong>${name}</strong>?<br><br><span class="text-sm text-red-600">The current week's progress will be reset and NOT saved in the history.</span>`,
                        'Yes, Swap',
                        () => {
                            appState.currentIndex = index;
                            appState.currentWeekTasks = {}; // Reset tasks for the new person
                            saveState();
                            updateDisplay();
                        }
                    );
                });
            }

            rotationListEl.appendChild(li);
        });
        
        createCheckboxes();
        updateChart();
    }
    
    function nextPerson(isAutoAdvance = false) {
        const proceed = () => {
            const completedTasksCount = Object.values(appState.currentWeekTasks || {}).filter(Boolean).length;
            const historyEntry = {
                person: names[appState.currentIndex],
                dateRange: getWeekDateRange(new Date(appState.currentWeekStartDate)),
                tasksCompleted: completedTasksCount,
                totalTasks: totalWeeklyTasks
            };
            appState.history.push(historyEntry);

            appState.currentIndex = (appState.currentIndex + 1) % names.length;
            appState.currentWeekTasks = {};
            appState.currentWeekStartDate = new Date().toISOString().split('T')[0];
            
            saveState();
            updateDisplay();
        };

        if (!isAutoAdvance && Object.keys(appState.currentWeekTasks || {}).length === 0) {
            showConfirmModal(
                'Advance to Next Week?',
                'No tasks have been recorded for this week. Do you want to proceed to the next week anyway?',
                'Yes, Proceed',
                proceed
            );
        } else {
            proceed();
        }
    }
    
    function initChart() {
        const ctx = document.getElementById('progressChart').getContext('2d');
        progressChart = new Chart(ctx, {
            type: 'doughnut',
            data: { labels: ['Completed', 'Pending'], datasets: [{ data: [0, totalWeeklyTasks], backgroundColor: ['#00796B', '#E0E0E0'], borderColor: ['#FDFBF8'], borderWidth: 4, hoverOffset: 4 }] },
            options: { responsive: true, maintainAspectRatio: false, cutout: '70%', plugins: { legend: { display: false }, tooltip: { enabled: false } } }
        });
    }

    function updateChart() {
        const checkedCount = Object.values(appState.currentWeekTasks || {}).filter(Boolean).length;
        progressChart.data.datasets[0].data[0] = checkedCount;
        progressChart.data.datasets[0].data[1] = totalWeeklyTasks - checkedCount;
        progressChart.update();
    }

    function renderHistory() {
        if (appState.history.length === 0) {
            historyContent.innerHTML = `<p class="text-center text-gray-500">No history available yet.</p>`;
            return;
        }
        historyContent.innerHTML = '';
        [...appState.history].reverse().forEach(entry => {
            const percentage = entry.totalTasks > 0 ? Math.round((entry.tasksCompleted / entry.totalTasks) * 100) : 0;
            const card = document.createElement('div');
            card.className = 'bg-gray-50 p-4 rounded-lg mb-3';
            card.innerHTML = `
                <div class="flex justify-between items-center">
                    <div>
                        <p class="font-bold text-teal-800">${entry.person}</p>
                        <p class="text-sm text-gray-500">Week: ${entry.dateRange.start} - ${entry.dateRange.end}</p>
                    </div>
                    <div class="text-right">
                         <p class="font-semibold">${entry.tasksCompleted} / ${entry.totalTasks} completed</p>
                         <div class="w-24 bg-gray-200 rounded-full h-2.5 mt-1">
                            <div class="bg-teal-600 h-2.5 rounded-full" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                </div>
            `;
            historyContent.appendChild(card);
        });
    }

    function exportHistory() {
        if (appState.history.length === 0) {
            alert("No history available to export.");
            return;
        }
        let exportText = "Shared Living Cleaning Rota History\n===================================\n\n";
        appState.history.forEach(entry => {
            exportText += `Week: ${entry.dateRange.start} - ${entry.dateRange.end}\n`;
            exportText += `Responsible: ${entry.person}\n`;
            exportText += `Completed: ${entry.tasksCompleted} of ${entry.totalTasks} tasks\n`;
            exportText += `--------------------\n\n`;
        });

        const blob = new Blob([exportText], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'cleaning-rota-history.txt';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
    
    function showConfirmModal(title, text, yesButtonText, onConfirm) {
        confirmModalTitle.textContent = title;
        confirmModalText.innerHTML = text;
        confirmModalYesBtn.textContent = yesButtonText;
        confirmAction = onConfirm;
        confirmModal.classList.remove('hidden');
    }

    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const targetTab = tab.dataset.tab;
            tabs.forEach(t => t.classList.remove('tab-active', 'tab-inactive'));
            tabs.forEach(t => t.classList.add(t === tab ? 'tab-active' : 'tab-inactive'));
            tabPanes.forEach(pane => pane.classList.toggle('hidden', pane.id !== `${targetTab}-tasks`));
        });
    });
    
    confirmModalYesBtn.addEventListener('click', () => {
        if (confirmAction) {
            confirmAction();
        }
        closeConfirmModal();
    });

    const closeConfirmModal = () => {
        confirmModal.classList.add('hidden');
        confirmAction = null;
    };

    confirmModalNoBtn.addEventListener('click', closeConfirmModal);
    confirmModal.querySelector('.modal-backdrop').addEventListener('click', closeConfirmModal);

    nextPersonBtn.addEventListener('click', () => nextPerson(false));
    showHistoryBtn.addEventListener('click', () => {
        renderHistory();
        historyModal.classList.remove('hidden');
    });
    closeHistoryBtn.addEventListener('click', () => historyModal.classList.add('hidden'));
    historyModal.querySelector('.modal-backdrop').addEventListener('click', () => historyModal.classList.add('hidden'));
    exportHistoryBtn.addEventListener('click', exportHistory);
    
    tabs[0].click();
    loadState();
    initChart();
    updateDisplay();
});
</script>

</body>
</html>

